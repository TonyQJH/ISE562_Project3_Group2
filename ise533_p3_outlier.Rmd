---
title: "ise533_p3_group2"
author: "Jinhu Qi"
date: "11/25/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# read the dataset

#View(df)
```{r}
df <- read.csv("Advertising.csv")
```

#split data
```{r}
a <- seq(1, 100, by=1)
b <- seq(101, 200, by=1)
train <- df[a,]
valid <- df[b,]

```

# we use training set in implement our regression
```{r}
model <- lm(train$Sales~train$TV+train$Radio)
summary(model)
```

# we have beta0 = 3.14699, beta1 = 0.04585 and beta2 = 0.18412
# this gonna be our cofficents in later caculation.
```{r}
b0 = 3.14699
b1 = 0.04585
b2 = 0.18412
```

# now calculate error in both training and valid set
```{r}
ev = replicate(100, 0)
ei = replicate(100, 0)
for (i in 1:100)
{
  ev[i] = valid$Sales[i]-b0-b1*valid$TV[i]-b2*valid$Radio[i]
}
for (i in 1:100){
  ei[i] = train$Sales[i]-b0-b1*train$TV[i]-b2*train$Radio[i]
}
```

#then we do the F-test
```{r}
F_test = var.test(ev, ei, alternative = "two.sided")
F_test
```

# not reject H0
# draw q-q plot
```{r}
qqnorm(ev, pch = 1, frame = FALSE)
qqline(ev, col = "red")

```

```{r}
qqnorm(ei, pch = 1, frame = FALSE)
qqline(ei, col = "red")

```


```{r}
boxplot(ev)
boxplot(ei)
```



# detect outlier and delete from data set
```{r}
# validation set:
which.min(ev)
ev[31]
valid <- valid[-which.min(ev),]
dim(valid)

# training set
which.min(ei)
ei[which.min(ei)]
train <- train[-which.min(ei),]
dim(train)

which.min(ei)
ei[which.min(ei)]
train <- train[-which.min(ei),]
dim(train)

which.min(ei)
ei[which.min(ei)]
train <- train[-which.min(ei),]
dim(train)

ei[6]
```

# Redo Regression
```{r}
new_df = rbind(train,valid)  
a <- seq(1, 98, by=1)
b <- seq(99, 196, by=1)
train1 <- new_df[a,]
valid1 <- new_df[b,]

train1 
valid1
```

```{r}

model1 <- lm(train1$Sales~train1$TV+train1$Radio)
summary(model1)
```

```{r}
b0 = 3.157054
b1 = 0.044285
b2 = 0.194257

ev1 = replicate(98, 0)
ei1 = replicate(98, 0)

for (i in 1:98)
{
  ev1[i] = valid1$Sales[i]-b0-b1*valid1$TV[i]-b2*valid1$Radio[i]
}
for (i in 1:98){
  ei1[i] = train1$Sales[i]-b0-b1*train1$TV[i]-b2*train1$Radio[i]
}

F_test1 = var.test(ev1, ei1, alternative = "two.sided")
F_test1

# print(toString(round(ei,3)))
```


# by julia we can get x1_hat and x2_hat
```{r}
x1_hat_dlm = 173.422
x2_hat_dlm = 26.577
```

#we can then calculate optimized w and note that it should be an array
```{r}
w_dlm = replicate(98, 0)
for (i in 1:98){
  w_dlm[i] = b0+b1*x1_hat_dlm+b2*x2_hat_dlm+ev1[i]
}
print(toString(w_dlm))
```
# then calculate the average objective function
```{r}
profit_dlm = c(72.0, 63.816326577, 71.641168977, 72.0, 72.0, 72.0, 72.0, 72.0, 72.0, 67.950903477, 72.0, 72.0, 70.376794077, 68.665340877, 69.95388917700001, 72.0, 72.0, 72.0, 70.426561677, 72.0, 68.384479977, 66.17011427700001, 71.609957577, 72.0, 72.0, 57.703706295, 72.0, 72.0, 72.0, 63.705102777, 62.660931477000005, 72.0, 67.530974577, 63.521151177, 64.899127677, 71.72378927700001, 70.521750777, 72.0, 72.0, 72.0, 72.0, 72.0, 72.0, 72.0, 65.975570877, 72.0, 66.694123377, 71.85417437699999, 65.435369277, 72.0, 72.0, 72.0, 72.0, 64.823435577, 70.602661677, 72.0, 61.369631277, 72.0, 72.0, 70.179409377, 71.650247577, 72.0, 72.0, 65.092365777, 62.237990577, 68.623461477, 71.457922077, 63.580235576999996, 72.0, 71.993723277, 71.010629577, 71.117828577, 65.499911277, 72.0, 72.0, 70.470749877, 59.711554795, 72.0, 71.707987077, 66.952503777, 72.0, 72.0, 69.196663377, 72.0, 72.0, 72.0, 64.131237777, 72.0, 65.728624077, 72.0, 72.0, 72.0, 72.0, 72.0, 72.0, 71.993179377, 72.0, 66.880808577)
c1 = 0.1
c2 = 0.5

```


```{r}
fix_dlm = -c1*x1_hat_dlm-c2*x2_hat_dlm
MVSAE_dlm = fix_dlm + profit_dlm
m = mean(MVSAE_dlm)
s = sd(MVSAE_dlm)
n = 98
error <- qnorm(0.975)*s/sqrt(n)

left <- m - error
right <- m + error
left
right
s
```


```{r}
toString(round(ei1,4))
```


```{r}
x1_saa = 182.33306
x2_saa = 17.66693
```

```{r}
w_saa = replicate(98, 0)
for (i in 1:98){
  w_saa[i] = b0+b1*x1_saa+b2*x2_saa+ev1[i]
}
print(toString(w_saa))
```

```{r}
profit_saa = c(69.38682384933, 59.67945841555, 67.63251744933, 68.98452684933, 70.75835424933, 70.38777714932999, 72.0, 72.0, 68.31192624933, 63.94225194933, 69.66328164933, 68.50233624933, 66.36814254933, 64.65668934933001, 65.94523764933, 68.29259184933, 72.0, 68.01550974933, 66.41791014933, 70.62895884933, 64.37582844933, 62.16146274933, 67.60130604933, 68.30590734933, 71.85797934933001, 51.02262041555, 72.0, 72.0, 72.0, 59.49408541555, 57.75379991555, 68.59527564933, 63.52232304933, 59.18749941555, 60.89047614933, 67.71513774933, 66.51309924933, 70.47109674933, 71.56096914932999, 69.75552624933, 70.17710844933, 72.0, 71.31397134933, 69.67281174933001, 61.96691934933, 72.0, 62.68547184933, 67.84552284933, 61.42671774933, 72.0, 68.48892084933, 69.62556294933, 68.07299604933, 60.81478404933, 66.59401014933, 68.16035184933, 55.60163291555, 68.99964324933, 68.25399054933, 66.17075784933, 67.64159604933, 69.35186784933, 70.08229344933, 61.08371424933, 57.04889841555, 64.61480994933001, 67.44927054933001, 59.28597341555, 70.31673954933, 67.98507174932999, 67.00197804933, 67.10917704933, 61.49125974933, 72.0, 68.51876694933, 66.46209834933, 53.030468915549996, 68.49113514933, 67.69933554933, 62.94385224933, 72.0, 72.0, 65.18801184933, 72.0, 69.66254154933, 68.30551494933, 60.12258624933, 69.08371554933001, 61.719972549329995, 71.89515384933, 71.54516604932999, 70.68303714933, 69.78459204933, 72.0, 72.0, 67.98452784933, 72.0, 62.87215704933)

fix = -c1*x1_saa-c2*x2_saa
MVSAE_saa = fix + profit_saa
m_saa = mean(MVSAE_saa)
s_saa = sd(MVSAE_saa)
n = 98
error_saa <- qnorm(0.975)*s_saa/sqrt(n)

left_saa <- m_saa - error_saa
right_saa <- m_saa + error_saa
left_saa
right_saa
s_saa
```
```{r}
toString(round(ei1,4))
```

#SD

```{r}
x1_sd = 182.292798
x2_sd = 17.707202
```

```{r}
w_sd = replicate(98, 0)
for (i in 1:98){
  w_sd[i] = b0+b1*x1_sd+b2*x2_sd+ev1[i]
}
print(toString(w_sd))
```

```{r}
profit_sd = c(69.404944195032, 59.70965899172, 67.650637795032, 69.002647195032, 70.776474595032, 70.40589749503201, 72.0, 72.0, 68.330046595032, 63.960372295032, 69.68140199503199, 68.520456595032, 66.386262895032, 64.674809695032, 65.963357995032, 68.310712195032, 72.0, 68.03363009503201, 66.436030495032, 70.647079195032, 64.393948795032, 62.179583095032, 67.61942639503201, 68.324027695032, 71.876099695032, 51.052820991720004, 72.0, 72.0, 72.0, 59.52428599172001, 57.78400049172, 68.613395995032, 63.540443395032, 59.217699991719996, 60.908596495032, 67.733258095032, 66.531219595032, 70.489217095032, 71.57908949503201, 69.773646595032, 70.195228795032, 72.0, 71.332091695032, 69.690932095032, 61.985039695032, 72.0, 62.703592195032, 67.863643195032, 61.444838095032, 72.0, 68.507041195032, 69.64368329503199, 68.091116395032, 60.832904395032, 66.612130495032, 68.178472195032, 55.63183349172, 69.017763595032, 68.272110895032, 66.188878195032, 67.659716395032, 69.369988195032, 70.100413795032, 61.101834595032, 57.07909899172, 64.632930295032, 67.467390895032, 59.31617399171999, 70.334859895032, 68.003192095032, 67.020098395032, 67.127297395032, 61.509380095032, 72.0, 68.536887295032, 66.480218695032, 53.06066949172, 68.509255495032, 67.717455895032, 62.961972595032, 72.0, 72.0, 65.206132195032, 72.0, 69.680661895032, 68.323635295032, 60.140706595032, 69.101835895032, 61.738092895032, 71.913274195032, 71.563286395032, 70.70115749503199, 69.802712395032, 72.0, 72.0, 68.00264819503201, 72.0, 62.890277395032)

fix = -c1*x1_sd-c2*x2_sd
MVSAE_sd = fix + profit_sd
m_sd = mean(MVSAE_sd)
s_sd = sd(MVSAE_sd)
n = 98
error_sd <- qnorm(0.975)*s_sd/sqrt(n)

left_sd <- m_sd - error_sd
right_sd <- m_sd + error_sd
left_sd
right_sd
s_sd
```


